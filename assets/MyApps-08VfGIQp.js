import{g as z}from"./getMessageFromError-KCSW6jpt.js";import{A as ee,R as te}from"./ActionsDropdown-ZJBlze7x.js";import{P as ae}from"./PageTitle-0cJCpiGE.js";import{_ as se,Y as ne,D as oe,Q as ie,v as L}from"./MetricsProvider.vue_vue_type_script_setup_true_lang-VBJ-fKN4.js";import{a as re,g as le,e as pe,s as ce,u as Y,c as de,d as ue,_ as he}from"./index-0rC--EyN.js";import{F as me}from"./feature-flags-wWQZYrRa.js";import{u as ge,c as fe}from"./useMachine-EefTuzQI.js";import{d as ve,a as r,c as P,o as ye,f as n,i as g,j as R,k as t,x as o,q as F,n as u,t as i,l as m,v as D,ah as Ae,ai as Te,S as Se,U as Ce}from"./vue-N1vwxG77.js";import"./CopyButton-N5Gd094k.js";import"./specRenderer-QZkoYPrL.js";import"./kongponents-juAo2PPt.js";const ke=ve({name:"MyApps",components:{PageTitle:ae,ActionsDropdown:ee,RefreshTokenModal:te,MetricsProvider:se,MetricsConsumer:ne},setup(){const{notify:e}=de(),l=r(""),C=r(""),N=r([]),I=r(0),H=P(()=>I.value.toString()),d=r(null),A=r(!1),T=r(null),{portalApiV2:f}=re(),v=le(me.AppRegV2,!1),k=r(!1),y=r(!0),_=pe(),{isDcr:w}=ce(_),b=Y().state.helpText.myApp,h=Y().state.helpText.analytics,M=r(!0),$=r({paginationPageSizes:[25,50,100],initialPageSize:25}),V=a=>{var c;return v?((c=a.auth_strategy)==null?void 0:c.credential_type)===ue.AuthStrategyCredentialType.ClientCredentials:w.value},s=P(()=>{var a;return`Delete ${(a=d.value)==null?void 0:a.name}`}),p=r([]),{state:O,send:K}=ge(fe({predictableActionArguments:!0,id:"DeveloperMachine",initial:"idle",states:{idle:{on:{FETCH:"pending",REJECT:"error"}},pending:{on:{RESOLVE:"success",REJECT:"error"}},success:{type:"final"},error:{on:{FETCH:"pending"}}}})),q=()=>{I.value+=1},J=async a=>{const{pageSize:c,page:E}=a,Z={pageNumber:E,pageSize:c,...C.value.length&&{filterNameContains:C.value}};return K("FETCH"),f.value.service.applicationsApi.listApplications(Z).then(S=>(K("RESOLVE"),p.value=S.data.data.map(x=>x.id),{data:S.data.data,total:S.data.meta.page.total})).catch(S=>{K("REJECT"),l.value=z(S)})},U=()=>{f.value.service.applicationsApi.deleteApplication({applicationId:d.value.id}).then(()=>{d.value=null,q(),e({message:"Application deleted"})}).catch(a=>{d.value=null,e({appearance:"danger",message:`Error: ${z(a)}`})})},j=a=>{f.value.service.credentialsApi.refreshApplicationToken({applicationId:a}).then(c=>{e({message:"Successfully refreshed secret"}),A.value=!0,T.value=c.data.client_secret}).catch(c=>{e({appearance:"danger",message:z(c)})})},Q=()=>{A.value=!1,T.value=null},W=[{label:"Name",key:"name"},{label:"Description",key:"description"},{hideLabel:!0,key:"actions"}],G=a=>a.key===L.ONE_DAY?`${h.summary24Hours} ${h.summary}`:a.key===L.THIRTY_DAY?`${h.summary30Days} ${h.summary}`:h.summary,B=P(()=>{var a;return!!(p.value&&((a=p.value)!=null&&a.length))}),X=P(()=>({queryReady:B.value,additionalFilter:[{type:oe.IN,dimension:ie.APPLICATION,values:p.value}]}));return ye(async()=>{var a,c;if(M.value=!1,v){y.value=!0;try{(c=(a=(await f.value.service.applicationsApi.listApplicationAuthStrategies()).data)==null?void 0:a.data)!=null&&c.length&&(k.value=!0),y.value=!1}catch(E){y.value=!1,e({appearance:"danger",message:`Error fetching application auth strategies: ${E}`})}}}),{modalTitle:s,errorMessage:l,applications:N,currentState:O,tableHeaders:W,handleDelete:U,fetchingAuthStrategies:y,isApplicationDcr:V,deleteItem:d,showSecretModal:A,appRegV2Enabled:v,hasAppAuthStrategies:k,token:T,onModalClose:Q,handleRefreshSecret:j,searchStr:C,fetcherCacheKey:H,fetcher:J,paginationConfig:$,helpText:b,helpTextVitals:h,analyticsCardTitle:G,vitalsLoading:M,metricProviderProps:X,myAppsReady:B}}}),be=e=>(Se("data-v-8413b178"),e=e(),Ce(),e),Me={width:"16",height:"16",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"mr-2"},Ee=be(()=>u("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M16 8A8 8 0 110 8a8 8 0 0116 0zM7 5a1 1 0 012 0v2h2a1 1 0 110 2H9v2a1 1 0 11-2 0V9H5a1 1 0 110-2h2V5z",fill:"#fff","fill-opacity":".75"},null,-1)),Pe={key:1},Re={class:"summary-tier-based mb-4"},De={class:"applications-toolbar"},Ie=["onClick"],_e=["onClick"],we=["onClick"];function $e(e,l,C,N,I,H){const d=n("KButton"),A=n("PageTitle"),T=n("KAlert"),f=n("MetricsConsumer"),v=n("KCard"),k=n("MetricsProvider"),y=n("KInput"),_=n("ActionsDropdown"),w=n("router-link"),b=n("EmptyState"),h=n("KTable"),M=n("KModal"),$=n("RefreshTokenModal"),V=n("Content");return g(),R(V,null,{default:t(()=>[o(A,{title:e.helpText.myApps,class:"mb-6"},{right:t(()=>[o(d,{"data-testid":"create-application-button",appearance:"primary",disabled:e.appRegV2Enabled&&!e.hasAppAuthStrategies,"is-rounded":!1,to:{name:"create-application"}},{default:t(()=>[(g(),F("svg",Me,[u("title",null,i(e.helpText.plus),1),Ee])),m(" "+i(e.helpText.newApp),1)]),_:1},8,["disabled"])]),_:1},8,["title"]),e.appRegV2Enabled&&!e.hasAppAuthStrategies&&!e.fetchingAuthStrategies?(g(),R(T,{key:0,"alert-message":e.helpText.authStrategyWarning,appearance:"warning",class:"no-auth-strategies-warning","data-testid":"no-auth-strategies-warning"},null,8,["alert-message"])):D("",!0),!e.vitalsLoading&&e.myAppsReady?(g(),F("div",Pe,[o(k,Ae(Te(e.metricProviderProps)),{default:t(({timeframe:s})=>[u("h2",Re,i(e.analyticsCardTitle(s)),1),o(v,{class:"mb-4 analytics-my-apps","data-testid":"analytics-metric-cards"},{body:t(()=>[o(f)]),_:1})]),_:1},16)])):D("",!0),u("div",null,[o(v,null,{body:t(()=>[o(h,{"data-testid":"applications-table","fetcher-cache-key":e.fetcherCacheKey,fetcher:e.fetcher,"has-side-border":"","has-error":e.currentState.matches("error"),"is-loading":e.currentState.matches("pending"),headers:e.tableHeaders,"is-clickable":"","is-small":"",class:"applications-table","pagination-page-sizes":e.paginationConfig.paginationPageSizes,"search-input":e.searchStr,"initial-fetcher-params":{pageSize:e.paginationConfig.initialPageSize},"onRow:click":l[1]||(l[1]=(s,p)=>e.$router.push({name:"show-application",params:{application_id:p.id}}))},{toolbar:t(({state:s})=>[u("div",De,[s.hasData||e.searchStr?(g(),R(y,{key:0,modelValue:e.searchStr,"onUpdate:modelValue":l[0]||(l[0]=p=>e.searchStr=p),placeholder:e.helpText.searchPlaceholder,type:"search"},null,8,["modelValue","placeholder"])):D("",!0)])]),name:t(({row:s})=>[m(i(s.name),1)]),actions:t(({row:s})=>[(g(),R(_,{key:s.id},{content:t(()=>[u("div",{"data-testid":"dropdown-analytics-dashboard",class:"py-2 px-3 type-md cursor-pointer",onClick:p=>e.$router.push({name:"application-dashboard",params:{application_id:s.id}})},i(e.helpTextVitals.viewAnalytics),9,Ie),e.isApplicationDcr(s)?(g(),F("div",{key:0,"data-testid":"dropdown-refresh-application-dcr-token",class:"py-2 px-3 type-md cursor-pointer",onClick:p=>e.handleRefreshSecret(s.id)},i(e.helpText.refreshSecret),9,_e)):D("",!0),u("div",{"data-testid":"dropdown-delete-application",class:"py-2 px-3 type-md cursor-pointer delete-item",onClick:p=>e.deleteItem=s},i(e.helpText.delete),9,we)]),_:2},1024))]),"empty-state":t(()=>[o(b,{title:e.searchStr?e.helpText.noSearchResults:e.helpText.noApp},{message:t(()=>[u("p",null,[o(w,{"data-testid":"create-application-link",to:{name:"create-application"}},{default:t(()=>[m(i(e.helpText.create),1)]),_:1}),m(" "+i(e.helpText.getStarted),1)])]),_:1},8,["title"])]),"error-state":t(()=>[o(b,{"is-error":"",title:e.helpText.noApp},{message:t(()=>[u("p",null,i("Error: "+e.errorMessage),1)]),_:1},8,["title"])]),_:1},8,["fetcher-cache-key","fetcher","has-error","is-loading","headers","pagination-page-sizes","search-input","initial-fetcher-params"])]),_:1})]),o(M,{title:e.modalTitle,"is-visible":!!e.deleteItem,"action-button-text":e.helpText.delete,"action-button-appearance":"danger",class:"delete-modal",onCanceled:l[3]||(l[3]=s=>e.deleteItem=null)},{"header-content":t(()=>[m(i(e.modalTitle),1)]),"body-content":t(()=>[m(i(e.helpText.deleteDialog(e.deleteItem.name)),1)]),"footer-content":t(()=>[o(d,{appearance:"danger","is-rounded":!1,class:"mr-3",onClick:e.handleDelete},{default:t(()=>[m(i(e.helpText.delete),1)]),_:1},8,["onClick"]),o(d,{appearance:"secondary","is-rounded":!1,onClick:l[2]||(l[2]=s=>e.deleteItem=null)},{default:t(()=>[m(i(e.helpText.cancel),1)]),_:1})]),_:1},8,["title","is-visible","action-button-text"]),o($,{"is-visible":e.showSecretModal,token:e.token,onClosed:e.onModalClose},null,8,["is-visible","token","onClosed"])]),_:1})}const Je=he(ke,[["render",$e],["__scopeId","data-v-8413b178"]]);export{Je as default};
